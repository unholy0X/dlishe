=== RUN   TestNewRateLimiter
--- PASS: TestNewRateLimiter (0.00s)
=== RUN   TestPublicRateLimiter
=== RUN   TestPublicRateLimiter/allows_requests_under_limit
=== RUN   TestPublicRateLimiter/blocks_requests_over_limit
=== RUN   TestPublicRateLimiter/different_IPs_have_separate_limits
--- PASS: TestPublicRateLimiter (0.04s)
    --- PASS: TestPublicRateLimiter/allows_requests_under_limit (0.00s)
    --- PASS: TestPublicRateLimiter/blocks_requests_over_limit (0.02s)
    --- PASS: TestPublicRateLimiter/different_IPs_have_separate_limits (0.02s)
=== RUN   TestGetIPIdentifier
=== RUN   TestGetIPIdentifier/simple_remote_addr
=== RUN   TestGetIPIdentifier/X-Forwarded-For_single_IP
=== RUN   TestGetIPIdentifier/X-Forwarded-For_multiple_IPs_-_should_take_first
=== RUN   TestGetIPIdentifier/X-Forwarded-For_with_spaces
=== RUN   TestGetIPIdentifier/X-Real-IP_takes_precedence_over_RemoteAddr
=== RUN   TestGetIPIdentifier/X-Forwarded-For_takes_precedence_over_X-Real-IP
    ratelimit_test.go:201: Expected "203.0.113.50", got "198.51.100.178"
=== RUN   TestGetIPIdentifier/IPv6_with_port
=== RUN   TestGetIPIdentifier/IPv6_without_port
=== RUN   TestGetIPIdentifier/X-Forwarded-For_with_IPv6
--- FAIL: TestGetIPIdentifier (0.00s)
    --- PASS: TestGetIPIdentifier/simple_remote_addr (0.00s)
    --- PASS: TestGetIPIdentifier/X-Forwarded-For_single_IP (0.00s)
    --- PASS: TestGetIPIdentifier/X-Forwarded-For_multiple_IPs_-_should_take_first (0.00s)
    --- PASS: TestGetIPIdentifier/X-Forwarded-For_with_spaces (0.00s)
    --- PASS: TestGetIPIdentifier/X-Real-IP_takes_precedence_over_RemoteAddr (0.00s)
    --- FAIL: TestGetIPIdentifier/X-Forwarded-For_takes_precedence_over_X-Real-IP (0.00s)
    --- PASS: TestGetIPIdentifier/IPv6_with_port (0.00s)
    --- PASS: TestGetIPIdentifier/IPv6_without_port (0.00s)
    --- PASS: TestGetIPIdentifier/X-Forwarded-For_with_IPv6 (0.00s)
=== RUN   TestStripPort
=== RUN   TestStripPort/192.168.1.1:8080
=== RUN   TestStripPort/192.168.1.1
=== RUN   TestStripPort/[::1]:8080
=== RUN   TestStripPort/[::1]
=== RUN   TestStripPort/::1
=== RUN   TestStripPort/2001:db8::1
=== RUN   TestStripPort/[2001:db8::1]:443
--- PASS: TestStripPort (0.00s)
    --- PASS: TestStripPort/192.168.1.1:8080 (0.00s)
    --- PASS: TestStripPort/192.168.1.1 (0.00s)
    --- PASS: TestStripPort/[::1]:8080 (0.00s)
    --- PASS: TestStripPort/[::1] (0.00s)
    --- PASS: TestStripPort/::1 (0.00s)
    --- PASS: TestStripPort/2001:db8::1 (0.00s)
    --- PASS: TestStripPort/[2001:db8::1]:443 (0.00s)
=== RUN   TestVideoExtractionRateLimiter
--- PASS: TestVideoExtractionRateLimiter (0.00s)
=== RUN   TestRateLimiterRedisFailure
redis: 2026/02/04 23:21:43 pool.go:426: redis: connection pool: failed to dial after 5 attempts: dial tcp 127.0.0.1:54382: connect: connection refused
redis: 2026/02/04 23:21:43 pool.go:426: redis: connection pool: failed to dial after 5 attempts: dial tcp 127.0.0.1:54382: connect: connection refused
redis: 2026/02/04 23:21:44 pool.go:426: redis: connection pool: failed to dial after 5 attempts: dial tcp 127.0.0.1:54382: connect: connection refused
redis: 2026/02/04 23:21:44 pool.go:426: redis: connection pool: failed to dial after 5 attempts: dial tcp 127.0.0.1:54382: connect: connection refused
--- PASS: TestRateLimiterRedisFailure (2.12s)
=== RUN   TestRateLimitHeaders
--- PASS: TestRateLimitHeaders (0.00s)
FAIL
FAIL	github.com/dishflow/backend/internal/middleware	2.469s
FAIL
